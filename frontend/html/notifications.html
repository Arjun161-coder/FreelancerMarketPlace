<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notifications</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    h2 { text-align: center; color: #333; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px 15px; border: 1px solid #ddd; text-align: left; }
    th { background-color: #333; color: white; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    .download-link { color: #007BFF; text-decoration: none; }
    .download-link:hover { text-decoration: underline; }
    .action-btn { padding: 6px 12px; border: none; border-radius: 6px; margin: 0 5px; cursor: pointer; font-weight: bold; }
    .accept-btn { background-color: #28a745; color: white; }
    .reject-btn { background-color: #dc3545; color: white; }
    .accept-btn:hover { background-color: #218838; }
    .reject-btn:hover { background-color: #c82333; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Bid Notifications</h2>
    <table id="notificationTable">
      <thead>
        <tr>
          <th>Freelancer Email</th>
          <th>Resume</th>
          <th>Days Required</th>
          <th>Bid Amount (₹)</th>
          <th>Actions</th> <!-- Added missing column -->
        </tr>
      </thead>
      <tbody>
        <!-- Data will be inserted here dynamically -->
      </tbody>
    </table>
  </div>

  <script>
    fetch("http://localhost:3000/getNotifications")
      .then((res) => res.json())
      .then((data) => {
        const tableBody = document.querySelector("#notificationTable tbody");
        tableBody.innerHTML = "";

        if (!Array.isArray(data) || data.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="5">No notifications found</td></tr>`;
          return;
        }

        data.forEach((item) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.freelancer_email}</td>
            <td><a href="/uploads/${item.resume}" class="download-link" target="_blank">View Resume</a></td>
            <td>${item.days_required}</td>
            <td>₹${item.bid_amount}</td>
            <td>
              <button class="action-btn accept-btn">Accept</button>
              <button class="action-btn reject-btn">Reject</button>
            </td>
          `;

          // Attach button events
          row.querySelector(".accept-btn").addEventListener("click", () => handleAction("accept", item.freelancer_email));
          row.querySelector(".reject-btn").addEventListener("click", () => handleAction("reject", item.freelancer_email));

          tableBody.appendChild(row);
        });
      })
      .catch((error) => {
        console.error("Error fetching notifications:", error);
        document.querySelector("#notificationTable tbody").innerHTML = `<tr><td colspan="5">Error loading notifications.</td></tr>`;
      });

    // ✅ Single function for both accept & reject
    function handleAction(type, email) {
      fetch(`http://localhost:3000/${type}Bid`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      })
        .then((res) => res.text())
        .then((msg) => {
          alert(msg);
          location.reload(); // refresh after action
        })
        .catch((err) => {
          console.error("Error:", err);
          alert("Something went wrong");
        });
    }
  </script>
</body>
</html>

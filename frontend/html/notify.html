<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Notifications</title>
  <style>
    /* === General Page Styles === */
body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  background: #f4f6f9;
  color: #333;
}

/* === Navbar === */
.navbar {
  background: #2c3e50;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 30px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.navbar h2 {
  margin: 0;
  font-size: 20px;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 20px;
  margin: 0;
  padding: 0;
}

.nav-links a {
  color: white;
  text-decoration: none;
  font-size: 16px;
  transition: color 0.3s ease;
}

.nav-links a:hover {
  color: #f39c12;
}

/* === Notifications Container === */
.notifications {
  max-width: 900px;
  margin: 2rem auto;
  padding: 20px;
}

/* === Notification Card === */
.notification-card {
  background: white;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 12px;
  box-shadow: 0px 4px 10px rgba(0,0,0,0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.notification-card:hover {
  transform: translateY(-3px);
  box-shadow: 0px 6px 14px rgba(0,0,0,0.12);
}

.notification-card h3 {
  margin-top: 0;
  color: #2c3e50;
  font-size: 18px;
}

.notification-card p {
  margin: 6px 0;
  line-height: 1.5;
}

.notification-card small {
  display: block;
  margin-top: 8px;
  color: #777;
}

/* === Buttons === */
.notification-card button {
  border: none;
  padding: 8px 14px;
  margin: 6px 8px 0 0;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.notification-card button:first-of-type {
  background: #27ae60;
  color: white;
}

.notification-card button:first-of-type:hover {
  background: #1e874b;
}

.notification-card button:last-of-type {
  background: #e74c3c;
  color: white;
}

.notification-card button:last-of-type:hover {
  background: #c0392b;
}

  </style>
</head>
<body>
  <div class="navbar">
    <h2>Freelancer Dashboard</h2>
    <ul class="nav-links">
      <li><a href="profile.html">Profile</a></li>
      <li><a href="notifications.html">Notifications</a></li>
      <li><a href="logout.html">Logout</a></li>
    </ul>
  </div>

  <div class="notifications" id="notifications"></div>

  <script>
    async function loadNotifications() {
      const freelancerEmail = localStorage.getItem("userEmail"); // ✅ set this on login
      if (!freelancerEmail) {
        document.getElementById("notifications").innerHTML = "<p>Please log in.</p>";
        return;
      }

      try {
        const res = await fetch(`http://localhost:3000/api/notifications/${freelancerEmail}`);
        const notifications = await res.json();

        const container = document.getElementById("notifications");
        container.innerHTML = "";

        if (notifications.length === 0) {
          container.innerHTML = "<p>No new notifications.</p>";
          return;
        }

        notifications.forEach(n => {
          const card = document.createElement("div");
          card.className = "notification-card";
          card.innerHTML = `
            <h3>${n.title}</h3>
            <p><strong>Client:</strong> ${n.client_email}</p>
            <p><strong>Requirements:</strong> ${n.requirements}</p>
            <p><strong>Budget:</strong> $${n.budget}</p>
            <p><strong>Deadline:</strong> ${n.deadline}</p>
            <p><strong>Status:</strong> ${n.status}</p>
            <small>Received: ${new Date(n.created_at).toLocaleString()}</small>
            <br><br>
            <button onclick="updateStatus(${n.id}, 'accepted')">✅ Accept</button>
            <button onclick="updateStatus(${n.id}, 'rejected')">❌ Reject</button>
          `;
          container.appendChild(card);
        });
      } catch (error) {
        console.error("Error loading notifications:", error);
      }
    }

    async function updateStatus(id, status) {
      try {
        const res = await fetch(`http://localhost:3000/api/hire/${id}/status`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ status })
        });

        if (res.ok) {
          alert("Status updated!");
          loadNotifications(); // refresh
        } else {
          alert("Failed to update status");
        }
      } catch (error) {
        console.error("Error updating status:", error);
      }
    }

    loadNotifications();
  </script>
</body>
</html>
